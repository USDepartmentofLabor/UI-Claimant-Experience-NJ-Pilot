#!/usr/bin/env python3

import datetime
import re
import sys

now = datetime.datetime.now()
current_datetime = now.strftime("%Y%m%d%H%M%S")
milliseconds_since_epoch = int(now.timestamp() * 1000)

descriptor_text = input(
    """
Enter a descriptor to include after the datetime.

Pattern:

    20220910163929_<descriptor>.sql

Example:

    20220910163929_add_new_table.sql

Must only include lowercase letters or underscores.

Note: datetime will be autogenerated.

Descriptor text: """
)


if not (bool(re.match("^[a-z_]+$", descriptor_text))):
    sys.exit("Descriptor must only contain lowercase letters or underscores")

author = input("Enter github username: ")

new_file = f"server/src/main/resources/db/changelog/changes/{current_datetime}_{descriptor_text}.sql"

with open(new_file, "w") as f:
    f.write("--liquibase formatted sql\n")
    f.write(f"--changeset {author}:{milliseconds_since_epoch}\n")
