# Image vulnerability scanning tools

- Status: Decided
- Deciders: Josh Clarridge
- Date: 2023-04-03

Scanning an application's deployment artifacts for vulnerabilities is an
important part of any CI/CD pipeline and a decision needs to be made around
which tool(s) to use.

This ADR is being written retrospectively to document a decision that was made
earlier in the project.

## Considered Alternatives

- Trivy
- Grype
- AWS ECR image scanning (basic)
- AWS ECR image scanning (enhanced)

## Pros and Cons of the Alternatives

### Trivy

> Trivy is a comprehensive and versatile security scanner. Trivy has scanners
> that look for security issues, and targets where it can find those issues.

[Trivy GitHub repo](https://github.com/aquasecurity/trivy)

- `+` Can be run as a GitHub Action in CI
- `+` Can be run locally
- `+` Scans OS and application packages
- `+` Easy to use and configure
- `+` Can be configured to only identify findings that have fixes available
- `+` Free, open source tool
- `+` The project team has previous experience with this tool

### Grype

> A vulnerability scanner for container images and filesystems.

[Grype GitHub repo](https://github.com/anchore/grype)

Trivy and Grype have the same pluses.

- `+` Can be run as a GitHub Action in CI
- `+` Can be run locally
- `+` Scans OS and application packages
- `+` Easy to use and configure
- `+` Can be configured to only identify findings that have fixes available
- `+` Free, open source tool
- `+` The project team has previous experience with this tool

### AWS ECR image scanning (basic)

> Amazon ECR provides basic scanning type which uses the Common Vulnerabilities
> and Exposures (CVEs) database from the open-source Clair project.

[ECR basic
scanning](https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning-basic.html)

- `+` Integrates directly with AWS ECR and can be configured to scan an image
  when it is pushed to a repository
- `+` Free
- `+` The project team has previous experience with this tool
- `-` Does not support all images
- `-` Only scans OS packages; does not scan application packages
- `-` Requires scripting or other tooling to retrieve and parse the results

### AWS ECR image scanning (enhanced)

> Amazon ECR enhanced scanning is an integration with Amazon Inspector which
> provides vulnerability scanning for your container images. Your container
> images are scanned for both operating systems and programing language package
> vulnerabilities.

[ECR enhanced
scanning](https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning-enhanced.html)

- `+` Integrates directly with AWS ECR and can be configured to scan an image
  when it is pushed to a repository
- `+` Can be configured for continual scanning
- `+` Scans OS and application packages
- `-` AWS charges for each scan
- `-` The project team does not have prior experience with this tool

## Decision Outcome

Use both Trivy and Grype as the project's primary image vulnerability scanning
tools. The tools are similar and easy to configure. Running both scans improves
confidence in the results and improves overall availability of the image
scanning pipeline in the event one tool is temporarily experiencing issues.

We will also enable ECR basic image scanning on our ECR repositories since that
has no additional charge and could be used as a fallback, when needed. However,
we do not plan to analyze the ECR scan findings as part of the CI pipeline.
